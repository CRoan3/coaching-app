<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../create-acc-style.css">
    <title>Create an Account</title>
</head>
<body>
  <div class="form-container">
    <H1 title="app-title"><a href="../index.html">Fitness App</H1></a>
      <H2>User Profile:</H2>
        <form id="create-acc-form" background="midnightblue" action="http://localhost:3000/register" method="POST">
            <label class="input-label" for="new-first-name">First name:
                <input type="text" id="new-first-name" placeholder="First name..." required>
            </label>
            <label class="input-label" for="new-last-name">Last name:
                <input type="text" id="new-last-name" placeholder="Last name..." required>
            </label>
            <label for="new-user-sex">Sex:   
                <select id="new-user-sex" required>
                 <option>(select one)</option>
                 <option>Male</option>
                 <option>Female</option>
                 <option>Non-binary or intersex</option>
               </select>
            </label>
            <label id="new-age-label" for="new-user-age">Birth Date:
                <input id="new-user-age" type="date" value="2024-07-29" min="1925-01-01" max="2018-12-31" required/>
            </label>
            <label for="new-username-training-status">Training status:   
                <select id="new-username-training-status">
                    <option>(select one)</option>
                    <option>Beginner (<1 year)</option>
                    <option>Intermediate (1-3 years)
                    </option>
                    <option>Advanced (>3 years)</option>
                    </select>
            </label>
            <label id="new-email-label" for="new-email">Enter Your Email Address:
                <input type="email" id="new-email" name="new-email" placeholder="Email address..."required autocomplete="new-email"/>
            </label>  
            <label id="new-username-label" for="new-username">Username:
                <input type="text" id="new-username" placeholder="Username:" autocomplete="username">
            </label>
            <label for="current-password">Enter Current Password
                <input type="password" id="current-password" name="new-password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number, one uppercase letter, one lowercase letter, and be at least 8 or more characters" required placeholder="Enter password..." autocomplete="new-password">
            </label>
            <label for="new-password">Enter New Password
                <input type="password" id="new-password" name="new-password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number, one uppercase letter, one lowercase letter, and be at least 8 or more characters" required placeholder="Enter password..." autocomplete="new-password">
            </label>
            <label for="new-password2">Re-enter desired password
                <input type="password" id="new-password2" name="new-password2" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number, one uppercase letter, one lowercase letter, and be at least 8 or more characters" placeholder="Re-enter password..." required autocomplete="new-password">
            </label>
            <button type="submit" onclick="createAcc()">Submit</button>
          </form>
        </div>
        <div id="message">
            <h3>Password must contain the following:</h3>
            <p id="letter" class="invalid">A lowercase letter</p>
            <p id="capital" class="invalid">A capital (uppercase) letter</p>
            <p id="number" class="invalid">A number</p>
            <p id="length" class="invalid">Minimum 8 characters</p>
            <p id="pw-match" class="invalid">Passwords match</p>
        </div>
<script>
var myInput = document.getElementById("new-password");
var myInput2 = document.getElementById("new-password2");
var letter = document.getElementById("letter");
var capital = document.getElementById("capital");
var number = document.getElementById("number");
var length = document.getElementById("length");
var pwMatch = document.getElementById("pw-match")

// When the user clicks on the password field, show the message box  

    myInput.onfocus = function() {
        document.getElementById("message").style.display = "block";
    }

    myInput2.onfocus = function() {
        document.getElementById("message").style.display = "block";
    }

 // When the user clicks outside of the password field, hide the message box
    myInput.onblur = function() {
        document.getElementById("message").style.display = "none";
    }

    myInput2.onblur = function() {
        document.getElementById("message").style.display = "none";
    }
 
    // When the user starts to type something inside the first password field
    myInput.onkeyup = function() {
    // Validate capital letters
    var lowerCaseLetters = /[a-z]/g; 
        if(myInput.value.match(lowerCaseLetters)) {
        letter.classList.remove("invalid");
        letter.classList.add("valid");
        } else {
        letter.classList.remove("valid");
        letter.classList.add("invalid");
    }

    // Validate capital letters
    var upperCaseLetters = /[A-Z]/g;
    if(myInput.value.match(upperCaseLetters)) {
      capital.classList.remove("invalid");
      capital.classList.add("valid");
    } else {
      capital.classList.remove("valid");
      capital.classList.add("invalid");
    }

    // Validate numbers
    var numbers = /[0-9]/g;
    if(myInput.value.match(numbers)) {
      number.classList.remove("invalid");
      number.classList.add("valid");
    } else {
      number.classList.remove("valid");
      number.classList.add("invalid");
    }

    // Validate length
    if(myInput.value.length >= 8) {
      length.classList.remove("invalid");
      length.classList.add("valid");
    } else {
      length.classList.remove("valid");
      length.classList.add("invalid");
    }
    
    //Validate pw match
    if(myInput.value == myInput2.value) {
      pwMatch.classList.remove("invalid");
      pwMatch.classList.add("valid");
    } else {
      pwMatch.classList.remove("valid");
      pwMatch.classList.add("invalid");
    } 
  }
// When the user starts to type something inside the second password field
  myInput2.onkeyup = function() {
    // Validate lowercase letters
    var lowerCaseLetters = /[a-z]/g;
    if(myInput2.value.match(lowerCaseLetters)) {
      letter.classList.remove("invalid");
      letter.classList.add("valid");
    } else {
      letter.classList.remove("valid");
      letter.classList.add("invalid");
  }

    // Validate capital letters
    var upperCaseLetters = /[A-Z]/g;
    if(myInput2.value.match(upperCaseLetters)) {
      capital.classList.remove("invalid");
      capital.classList.add("valid");
    } else {
      capital.classList.remove("valid");
      capital.classList.add("invalid");
    }

    // Validate numbers
    var numbers = /[0-9]/g;
    if(myInput2.value.match(numbers)) {
      number.classList.remove("invalid");
      number.classList.add("valid");
    } else {
      number.classList.remove("valid");
      number.classList.add("invalid");
    }

    // Validate length
    if(myInput2.value.length >= 8) {
      length.classList.remove("invalid");
      length.classList.add("valid");
    } else {
      length.classList.remove("valid");
      length.classList.add("invalid");
    }

    //Validate pw match
    if(myInput.value == myInput2.value) {
      pwMatch.classList.remove("invalid");
      pwMatch.classList.add("valid");
    } else {
      pwMatch.classList.remove("valid");
      pwMatch.classList.add("invalid");
    } 

    if(myInput.value == myInput2.value) {
    document.getElementById("message").style.display = "none";
    } 
  }

    // Login functionality

    var objUsers = [
    {
        username: "Chris",
        password: "pw123456"
    },
    {
        username: "Tanner",
        password: "pw654321"
    }
    ]


    function login() {
    //retrieve data from user input (user and pw)
    var objUsers = JSON.parse(localStorage.getItem("objUsers"));
    var username = document.getElementById("username").value;
    var password = document.getElementById("password").value;

    for(i = 0; i < objUsers.length; i++) {
        if(username == objUsers[i].username && password == objUsers[i].password) {
            console.log(username + " is logged in.")
            return
        }
    } 
    console.log(JSON.parse(localStorage.getItem("objUsers")));
    }



    //collecting form data and adding newUser to objUsers for login
    function createAcc() {
    var registerUserFirstName = document.getElementById("new-first-name").value;
    var registerUserLastName = document.getElementById("new-last-name").value;
    var registerUserSex = document.getElementById("new-user-sex").value;
    var registerUserTS = document.getElementById("new-username-training-status").value;
    var registerUserEmail = document.getElementById("new-email").value;
    var registerUserAge = document.getElementById("new-user-age").value;
    var registerUser = document.getElementById("new-username").value;
    var registerPassword = document.getElementById("new-password").value;
    var newUser = {
        username: registerUser,
        password: registerPassword,
        firstName: registerUserFirstName,
        lastName: registerUserLastName,
        sex: registerUserSex,
        trainingStatus: registerUserTS,
        email: registerUserEmail,
        age: registerUserAge
        }

    for (i=0; i < objUsers.length; i++) {
        if(registerUser == objUsers[i].username) {
        alert("That username is taken, please use another.")
        return
        }
    }

    objUsers.push(newUser);
    //console.log(objUsers);
    localStorage.objUsers = JSON.stringify(objUsers); //storing locally so we can test login functionality
    console.log(JSON.parse(localStorage.getItem("objUsers")));  
    }


    const accForm = document.getElementById("create-acc-form");

    accForm.addEventListener('submit', (e) => {
        e.preventDefault();

        const formData = new FormData(accForm);

        fetch('http://localhost:3000/register', {
            method: "POST",
            body: formData, 
        })
            .then(res => res.json())
            .then(res => console.log(res));

    })
</script>
</body>
</html>